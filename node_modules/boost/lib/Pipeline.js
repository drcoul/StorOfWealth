'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _Routine = require('./Routine');

var _Routine2 = _interopRequireDefault(_Routine);

var _Tool = require('./Tool');

var _Tool2 = _interopRequireDefault(_Tool);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * @copyright   2017, Miles Johnson
 * @license     https://opensource.org/licenses/MIT
 * 
 */

class Pipeline extends _Routine2.default {
  constructor(tool) {
    super('root', 'Pipeline', tool ? tool.config : {});

    this.loadTasks = () => this.subroutines;

    if (!tool || !(tool instanceof _Tool2.default)) {
      throw new Error('A build `Tool` instance is required to operate the pipeline.');
    }

    this.tool = tool;
  }

  run(initialValue = null, context = {}) {
    this.context = context;

    return this.serializeSubroutines(initialValue).finally(() => {
      this.tool.closeConsole();
    });
  }
}
exports.default = Pipeline;